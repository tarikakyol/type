/*
 utfx (c) 2014 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/utfx for details
*/
(function(g,f){Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var d={MAX_CODEPOINT:1114111,encodeUTF8:function(a,c){var b=null;"number"===typeof a&&(b=a,a=function(){return null});for(;null!==b||null!==(b=a());)128>b?c(b&127):(2048>b?c(b>>6&31|192):(65536>b?c(b>>12&15|224):(c(b>>18&7|240),c(b>>12&63|128)),c(b>>6&63|128)),c(b&63|128)),b=null},decodeUTF8:function(a,c){function b(a){a=a.slice(0,a.indexOf(null));var b=Error(a.toString());b.name=
"TruncatedError";b.bytes=a;throw b;}for(var e,d,f,g;null!==(e=a());)if(0===(e&128))c(e);else if(192===(e&224))null===(d=a())&&b([e,d]),c((e&31)<<6|d&63);else if(224===(e&240))null!==(d=a())&&null!==(f=a())||b([e,d,f]),c((e&15)<<12|(d&63)<<6|f&63);else if(240===(e&248))null!==(d=a())&&null!==(f=a())&&null!==(g=a())||b([e,d,f,g]),c((e&7)<<18|(d&63)<<12|(f&63)<<6|g&63);else throw RangeError("Illegal starting byte: "+e);},UTF16toUTF8:function(a,c){for(var b,d=null;null!==(b=null!==d?d:a());)55296<=b&&
57343>=b&&null!==(d=a())&&56320<=d&&57343>=d?(c(1024*(b-55296)+d-56320+65536),d=null):c(b);null!==d&&c(d)},UTF8toUTF16:function(a,c){var b=null;"number"===typeof a&&(b=a,a=function(){return null});for(;null!==b||null!==(b=a());)65535>=b?c(b):(b-=65536,c((b>>10)+55296),c(b%1024+56320)),b=null},encodeUTF16toUTF8:function(a,c){d.UTF16toUTF8(a,function(a){d.encodeUTF8(a,c)})},decodeUTF8toUTF16:function(a,c){d.decodeUTF8(a,function(a){d.UTF8toUTF16(a,c)})},calculateCodePoint:function(a){return 128>a?1:
2048>a?2:65536>a?3:4},calculateUTF8:function(a){for(var c,b=0;null!==(c=a());)b+=d.calculateCodePoint(c);return b},calculateUTF16asUTF8:function(a){var c=0,b=0;d.UTF16toUTF8(a,function(a){++c;b+=d.calculateCodePoint(a)});return[c,b]}},h=f.fromCharCode;d.arraySource=function(a){if(!Array.isArray(a))throw TypeError("Illegal argument: "+typeof a);var c=0;return function(){return c>=a.length?null:a[c++]}};d.arrayDestination=function(a){if(!Array.isArray(a))throw TypeError("Illegal argument: "+typeof a);
return Array.prototype.push.bind(a)};d.stringSource=function(a){if("string"!==typeof a)throw TypeError("Illegal argument: "+typeof a);var c=0;return function(){return c>=a.length?null:a.charCodeAt(c++)}};d.stringDestination=function(){var a=[],c=[];return function(){if(0===arguments.length)return c.join("")+h.apply(f,a);1024<a.length+arguments.length&&(c.push(h.apply(f,a)),a.length=0);Array.prototype.push.apply(a,arguments)}};d.assertCharCode=function(a){if("number"!==typeof a||a!==a)throw TypeError("Illegal char code: "+
typeof a);if(0>a||65535<a)throw RangeError("Illegal char code: "+a);return a};d.assertCodePoint=function(a){if("number"!==typeof a||a!==a)throw TypeError("Illegal code point: "+typeof a);if(0>a||a>d.MAX_CODEPOINT)throw RangeError("Illegal code point: "+a);return a};d.fromCodePoint=function(a){var c,b=0,e=arguments,f=e.length;d.UTF8toUTF16(function(){return b<f?d.assertCodePoint(e[b++]):null},c=d.stringDestination());return c()};d.codePointAt=function(a,c){if("string"!==typeof a&&!(a&&a instanceof
f)||"number"!==typeof c)throw TypeError("Illegal arguments: "+typeof a+", "+typeof c);var b,e;if(!(0>c||c>=(b=a.length)))return d.UTF16toUTF8(function(){return"undefined"===typeof e&&c<b?a.charCodeAt(c++):null},function(a){e=a}),e};d.polyfill=function(a){if(!f.fromCodePoint||a)f.fromCodePoint=d.fromCodePoint;if(!f.prototype.codePointAt||a)f.prototype.codePointAt=function(a){return d.codePointAt(this,a)};return d};"object"===typeof module&&module&&module.exports?module.exports=d:"function"===typeof define&&
define.amd?define(d):(g.dcodeIO||(g.dcodeIO={}),g.dcodeIO.utfx=d)})(this,String);
